<aura:component implements="flexipage:availableForRecordHome,force:hasRecordId"
				access="global" controller="aqi_WrapperCtrl" extends="c:aqi_Abstract" >

    <!-- ATTRIBUTES -->
	<aura:attribute access="global" name="displayFollowUpSection" type="Boolean" default="true" />
	<aura:attribute name="noFieldsAvailable" type="Boolean" default="false" />

	<aura:attribute access="global" name="indexField1" type="String" default="none" />
	<aura:attribute access="global" name="indexField2" type="String" default="none" />
	<aura:attribute access="global" name="indexField3" type="String" default="none" />
	<aura:attribute access="global" name="indexField4" type="String" default="none" />
	<aura:attribute access="global" name="indexField5" type="String" default="none" />
	<aura:attribute access="global" name="indexField6" type="String" default="none" />
	<aura:attribute access="global" name="indexField7" type="String" default="none" />
	<aura:attribute access="global" name="indexField8" type="String" default="none" />
	<aura:attribute access="global" name="indexField9" type="String" default="none" />
	<aura:attribute access="global" name="indexField10" type="String" default="none" />

	<aura:attribute access="global" name="prefixOrg" type="String" default="none" />

	<aura:attribute access="global" name="aqi_record" type="Article_Quality__c" default="{ 'sobjectType': 'Article_Quality__c' }"  />
	<aura:attribute access="global" name="apiNames" type="List" default="" />
	<aura:attribute access="global" name="aqi_appIsConfigured" type="Boolean" default="true"/>

	<!-- HANDLERS-->
	<aura:handler name="init" action="{!c.doInit}" value="{!this}" />


	<aura:if isTrue="{!v.aqi_appIsConfigured}">
		<article class="slds-card">
			<div class="slds-card__header slds-grid ">
				<header class="slds-media slds-media_center slds-has-flexi-truncate">

					<div class="slds-media__body">
						<h2>
							<a href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="{!v.aqi_record.Name}">
								<span class="slds-text-heading_small">Article Quality Index</span>
							</a>
						</h2>
					</div>

					<div class="slds-no-flex">
						<span class="slds-badge slds-badge_lightest slds-p-around_small">Score :
							<ui:outputNumber value="{!v.aqi_record.AQ_Score__c}" format="."/>
						</span>
					</div>
				</header>

			</div>

			<div class="buttonsContainer slds-align_absolute-center">
				<lightning:button aura:id="applyButtonTop" variant="brand" class="slds-button slds-button--brand applyButton" label="Apply" onclick="{!c.updateAQI}" />
			</div>
			<div class="slds-card__body slds-card__body_inner slds-border_top slds-m-top_medium">
				<p class="slds-p-horizontal--small">
					<div class="slds-text-heading_medium mediumTitle">Index Fields</div>

					<!-- If there are no fields selected in the app builder this paragraph will be displayed. Otherwise it is hidden -->
					<aura:if isTrue="{!v.noFieldsAvailable}">
						<p class="noFieldsMessage">&nbsp; No index fields were selected in the App Builder</p>
					</aura:if>

					<!-- Fields container -->
					<div aura:id="fieldsContainer" class="fieldsContainer" />

					<aura:if isTrue="{!v.displayFollowUpSection}">
						<!-- AQI input fileds section -->
						<hr/>

						<div class="slds-text-heading_medium">Follow Up</div>

						<!-- Follow up section -->
						<lightning:layout horizontalAlign="space" verticalAlign="center">
							<lightning:layoutItem size="9" flexibility="auto" padding="around-small">
								<div class="slds-size_1-of-1">
									<p class="slds-truncate" title="{!v.fieldLabel}">
										<ui:outputText value="Coaching Needed" />
									</p>
								</div>
							</lightning:layoutItem>

							<lightning:layoutItem size="3" flexibility="auto" padding="around-small">
								<force:inputField aura:id="Action_Needed__c" value="{!v.aqi_record.Action_Needed__c}"/>
							</lightning:layoutItem>
						</lightning:layout>

						<lightning:layout horizontalAlign="space" verticalAlign="center">
							<lightning:layoutItem size="3" flexibility="auto" padding="around-small">
								<div class="slds-size_1-of-1">
									<p class="slds-truncate" title="Action date">
										<ui:outputText value="Action Date" />
									</p>
								</div>
							</lightning:layoutItem>

							<lightning:layoutItem size="9" flexibility="auto" padding="around-small">
									<force:inputField aura:id="Action_Date__c" value="{!v.aqi_record.Action_Date__c}"/>
							</lightning:layoutItem>
						</lightning:layout>

						<lightning:layout horizontalAlign="space" verticalAlign="center">
							<lightning:layoutItem size="3" flexibility="auto" padding="around-small">
								<div class="slds-size_1-of-1">
									<p class="slds-truncate" title="Action assigned to">
										<ui:outputText value="Action assigned to "/>
									</p>
								</div>
							</lightning:layoutItem>

							<lightning:layoutItem size="9" flexibility="auto" padding="around-small">
									<force:inputField aura:id="Action_Assigned_To__c" value="{!v.aqi_record.Action_Assigned_To__c}"/>
							</lightning:layoutItem>
						</lightning:layout>

						<lightning:layout horizontalAlign="space" verticalAlign="center">
							<lightning:layoutItem size="3" flexibility="auto" padding="around-small">
								<div class="slds-size_1-of-1">
									<p class="slds-truncate" title="Action taken">
										<ui:outputText value="Action taken " />
									</p>
								</div>
							</lightning:layoutItem>

							<lightning:layoutItem size="9" flexibility="auto" padding="around-small">
									<force:inputField value="{!v.aqi_record.Action_Taken__c}"/>
							</lightning:layoutItem>
						</lightning:layout>

						<lightning:layout horizontalAlign="space" verticalAlign="center">
							<lightning:layoutItem size="3" flexibility="auto" padding="around-small">
								<div class="slds-size_1-of-1">
									<p class="slds-truncate" title="Internal notes">
										<ui:outputText value="Internal notes" />
									</p>
								</div>
							</lightning:layoutItem>

							<lightning:layoutItem size="9" flexibility="auto" padding="around-small">
									<force:inputField value="{!v.aqi_record.Internal_Notes__c}"/>
							</lightning:layoutItem>
						</lightning:layout>
					</aura:if>
				</p>
			</div>

			<footer class="slds-card__footer">
				<c:aqi_Toast aura:id="toastNotif"/>

				<div class="buttonsContainer slds-align_absolute-center">
					<lightning:button aura:id="applyButton" variant="brand" class="slds-button slds-button--brand applyButton" label="Apply" onclick="{!c.updateAQI}" />
				</div>
			</footer>
		</article>

		<aura:set attribute="else">
		    <lightning:card >
		        <p class="slds-p-horizontal_small">
					<ui:message title="Warning" severity="warning" closable="false">
						You need to configure the app
					</ui:message>
		        </p>
		    </lightning:card>
		</aura:set>
	</aura:if>
</aura:component>
